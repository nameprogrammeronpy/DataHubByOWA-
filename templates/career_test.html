{% extends "base.html" %}

{% block title %}–ü—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç ‚Äî DataHub –í–£–ó-–æ–≤ –†–ö{% endblock %}

{% block content %}
<section class="test-hero">
    <div class="container">
        <div class="test-hero-content">
            <span class="badge-free">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
            <h1><i class="fas fa-brain"></i> –ü—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç</h1>
            <p>–£–∑–Ω–∞–π —Å–≤–æ–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∏ –ø–æ–ª—É—á–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ —Å –ø–æ–º–æ—â—å—é AI</p>
            <div class="test-features">
                <div class="feature"><i class="fas fa-clock"></i> 5-7 –º–∏–Ω—É—Ç</div>
                <div class="feature"><i class="fas fa-robot"></i> AI-–∞–Ω–∞–ª–∏–∑</div>
                <div class="feature"><i class="fas fa-chart-bar"></i> –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç</div>
            </div>
        </div>
    </div>
</section>

<section class="test-container">
    <div class="container">
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
        <div class="test-progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <span class="progress-text" id="progressText">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 15</span>
        </div>

        <!-- –í–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–∞ -->
        <div id="testQuestions" class="test-questions">
            <!-- –í–æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è JS -->
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div id="testResults" class="test-results" style="display: none;">
            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>

        <!-- –ü–ª–∞—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã -->
        <div id="premiumTests" class="premium-tests" style="display: none;">
            <h2><i class="fas fa-crown"></i> –£–≥–ª—É–±–ª—ë–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã</h2>
            <p>–ü–æ–ª—É—á–∏—Ç–µ –µ—â—ë –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏</p>

            <div class="premium-grid">
                <div class="premium-card">
                    <div class="premium-badge">–ü–æ–ø—É–ª—è—Ä–Ω—ã–π</div>
                    <h3>–¢–µ—Å—Ç –Ω–∞ —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏</h3>
                    <p>60 –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Ä¢ MBTI –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è</p>
                    <ul>
                        <li><i class="fas fa-check"></i> –ü–æ–ª–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç—Ä–µ—Ç</li>
                        <li><i class="fas fa-check"></i> –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º–∏</li>
                        <li><i class="fas fa-check"></i> PDF-–æ—Ç—á—ë—Ç –Ω–∞ 10 —Å—Ç—Ä–∞–Ω–∏—Ü</li>
                    </ul>
                    <div class="premium-price">1 000 ‚Ç∏</div>
                    <button class="btn btn-primary btn-full" onclick="showPaymentModal('personality')">
                        <i class="fas fa-lock"></i> –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç
                    </button>
                </div>

                <div class="premium-card">
                    <h3>–ö–∞—Ä—å–µ—Ä–Ω—ã–π –∫–æ–º–ø–∞—Å</h3>
                    <p>45 –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Ä¢ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–≥—Ä–∞–º–º–∞</p>
                    <ul>
                        <li><i class="fas fa-check"></i> 20+ –∫–∞—Ä—å–µ—Ä–Ω—ã—Ö –ø—É—Ç–µ–π</li>
                        <li><i class="fas fa-check"></i> –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ —Ç—Ä—É–¥–∞</li>
                        <li><i class="fas fa-check"></i> Roadmap —Ä–∞–∑–≤–∏—Ç–∏—è</li>
                    </ul>
                    <div class="premium-price">1 500 ‚Ç∏</div>
                    <button class="btn btn-primary btn-full" onclick="showPaymentModal('career')">
                        <i class="fas fa-lock"></i> –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç
                    </button>
                </div>

                <div class="premium-card">
                    <div class="premium-badge gold">VIP</div>
                    <h3>–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h3>
                    <p>–í—Å–µ —Ç–µ—Å—Ç—ã + –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</p>
                    <ul>
                        <li><i class="fas fa-check"></i> –í—Å–µ —Ç–µ—Å—Ç—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</li>
                        <li><i class="fas fa-check"></i> 30 –º–∏–Ω —Å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º</li>
                        <li><i class="fas fa-check"></i> –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω</li>
                    </ul>
                    <div class="premium-price">5 000 ‚Ç∏</div>
                    <button class="btn btn-accent btn-full" onclick="showPaymentModal('vip')">
                        <i class="fas fa-crown"></i> –ü–æ–ª—É—á–∏—Ç—å VIP
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Payment Modal -->
<div id="paymentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-lock"></i> –û–ø–ª–∞—Ç–∞</h2>
            <button class="modal-close" onclick="closePaymentModal()">&times;</button>
        </div>
        <div class="modal-body" style="text-align: center; padding: 40px;">
            <i class="fas fa-tools" style="font-size: 4rem; color: var(--primary); margin-bottom: 20px;"></i>
            <h3>–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3>
            <p style="color: var(--gray); margin: 15px 0;">–û–ø–ª–∞—Ç–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏!</p>
            <button class="btn btn-primary" onclick="closePaymentModal()">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>
</div>

<style>
.test-hero {
    padding: 120px 20px 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-align: center;
}

.badge-free {
    display: inline-block;
    background: rgba(255,255,255,0.2);
    padding: 8px 20px;
    border-radius: 20px;
    font-weight: 600;
    margin-bottom: 20px;
}

.test-hero h1 {
    font-size: 2.5rem;
    margin-bottom: 15px;
}

.test-hero h1 i {
    margin-right: 15px;
}

.test-hero p {
    font-size: 1.1rem;
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto 30px;
}

.test-features {
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
}

.test-features .feature {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.15);
    padding: 10px 20px;
    border-radius: 25px;
}

.test-container {
    padding: 50px 0 80px;
}

.test-progress {
    max-width: 600px;
    margin: 0 auto 40px;
    text-align: center;
}

.progress-bar {
    height: 8px;
    background: var(--light);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 10px;
}

.progress-fill {
    height: 100%;
    background: var(--gradient);
    border-radius: 10px;
    transition: width 0.3s ease;
}

.progress-text {
    color: var(--gray);
    font-size: 0.9rem;
}

.test-questions {
    max-width: 700px;
    margin: 0 auto;
}

.question-card {
    background: var(--white);
    border-radius: var(--radius);
    padding: 40px;
    box-shadow: var(--shadow);
    margin-bottom: 20px;
    display: none;
}

.question-card.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.question-card h3 {
    font-size: 1.3rem;
    margin-bottom: 25px;
    line-height: 1.5;
}

.question-card h3 .q-number {
    display: inline-block;
    width: 35px;
    height: 35px;
    background: var(--gradient);
    color: white;
    border-radius: 50%;
    text-align: center;
    line-height: 35px;
    font-size: 0.9rem;
    margin-right: 12px;
}

.answers-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.answer-option {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    border: 2px solid var(--light);
    border-radius: 10px;
    cursor: pointer;
    transition: var(--transition);
}

.answer-option:hover {
    border-color: var(--primary-light);
    background: rgba(99, 102, 241, 0.05);
}

.answer-option.selected {
    border-color: var(--primary);
    background: rgba(99, 102, 241, 0.1);
}

.answer-option input {
    display: none;
}

.answer-option .radio-custom {
    width: 22px;
    height: 22px;
    border: 2px solid var(--gray);
    border-radius: 50%;
    margin-right: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.answer-option.selected .radio-custom {
    border-color: var(--primary);
    background: var(--primary);
}

.answer-option.selected .radio-custom::after {
    content: '';
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
}

.question-nav {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
}

/* Results */
.test-results {
    max-width: 900px;
    margin: 0 auto;
}

.results-header {
    text-align: center;
    margin-bottom: 40px;
}

.results-header h2 {
    font-size: 2rem;
    margin-bottom: 10px;
}

.results-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    margin-bottom: 40px;
}

.result-card {
    background: var(--white);
    border-radius: var(--radius);
    padding: 25px;
    box-shadow: var(--shadow);
}

.result-card h4 {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    color: var(--primary);
}

.result-card.full-width {
    grid-column: 1 / -1;
}

.personality-badge {
    background: var(--gradient);
    color: white;
    padding: 15px 25px;
    border-radius: var(--radius);
    font-size: 1.1rem;
    text-align: center;
}

.skills-chart {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.skill-bar {
    display: flex;
    align-items: center;
    gap: 15px;
}

.skill-bar .label {
    width: 100px;
    font-size: 0.9rem;
}

.skill-bar .bar {
    flex: 1;
    height: 12px;
    background: var(--light);
    border-radius: 10px;
    overflow: hidden;
}

.skill-bar .fill {
    height: 100%;
    background: var(--gradient);
    border-radius: 10px;
    transition: width 1s ease;
}

.skill-bar .value {
    width: 40px;
    text-align: right;
    font-weight: 600;
    color: var(--primary);
}

.tags-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.tag {
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9rem;
}

.careers-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.career-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 15px;
    background: var(--light);
    border-radius: 8px;
}

.career-item i {
    color: var(--secondary);
}

.advice-text {
    font-size: 1.1rem;
    line-height: 1.7;
    color: var(--dark);
}

.uni-recommendations {
    margin-top: 40px;
}

.uni-recommendations h3 {
    text-align: center;
    margin-bottom: 25px;
}

.uni-rec-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.uni-rec-card {
    background: var(--white);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
    border: 2px solid transparent;
    transition: var(--transition);
}

.uni-rec-card:hover {
    border-color: var(--primary);
    transform: translateY(-5px);
}

.uni-rec-card h4 {
    font-size: 1rem;
    margin-bottom: 8px;
}

.uni-rec-card .city {
    color: var(--gray);
    font-size: 0.85rem;
    margin-bottom: 10px;
}

.uni-rec-card .focus-tag {
    display: inline-block;
    background: var(--light);
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.8rem;
    margin-bottom: 12px;
}

.uni-rec-card .btn {
    width: 100%;
}

/* Premium Tests */
.premium-tests {
    margin-top: 60px;
    padding-top: 60px;
    border-top: 2px solid var(--light);
    text-align: center;
}

.premium-tests h2 {
    margin-bottom: 10px;
}

.premium-tests h2 i {
    color: #f59e0b;
}

.premium-tests > p {
    color: var(--gray);
    margin-bottom: 30px;
}

.premium-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 25px;
    max-width: 1000px;
    margin: 0 auto;
}

.premium-card {
    background: var(--white);
    border-radius: var(--radius);
    padding: 30px;
    box-shadow: var(--shadow);
    position: relative;
    text-align: left;
}

.premium-badge {
    position: absolute;
    top: -10px;
    right: 20px;
    background: var(--primary);
    color: white;
    padding: 5px 15px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
}

.premium-badge.gold {
    background: linear-gradient(135deg, #f59e0b, #d97706);
}

.premium-card h3 {
    margin-bottom: 5px;
}

.premium-card > p {
    color: var(--gray);
    font-size: 0.9rem;
    margin-bottom: 15px;
}

.premium-card ul {
    list-style: none;
    margin-bottom: 20px;
}

.premium-card ul li {
    padding: 8px 0;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.9rem;
}

.premium-card ul li i {
    color: var(--secondary);
}

.premium-price {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 15px;
}

.btn-accent {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 2000;
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: var(--radius);
    max-width: 400px;
    width: 90%;
}

.modal-header {
    padding: 20px;
    border-bottom: 1px solid var(--light);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--gray);
}

/* Loading - Dark Theme */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(26, 29, 41, 0.98);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 3000;
    animation: fadeInLoading 0.15s ease-out;
}

@keyframes fadeInLoading {
    from { opacity: 0; }
    to { opacity: 1; }
}

.loading-content {
    text-align: center;
    animation: pulseLoading 2s ease-in-out infinite;
}

@keyframes pulseLoading {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

.loading-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 24px;
    position: relative;
}

.loading-spinner {
    width: 80px;
    height: 80px;
    border: 4px solid rgba(108, 92, 231, 0.2);
    border-top-color: #6C5CE7;
    border-right-color: #00D9FF;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loading-brain {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 32px;
    color: #6C5CE7;
    animation: brainPulse 1.5s ease-in-out infinite;
}

@keyframes brainPulse {
    0%, 100% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
    50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
}

.loading-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #FFFFFF;
    margin-bottom: 12px;
}

.loading-text {
    font-size: 1rem;
    color: #A0A3B1;
    margin-bottom: 32px;
}

.loading-progress {
    width: 280px;
    height: 6px;
    background: rgba(108, 92, 231, 0.2);
    border-radius: 3px;
    overflow: hidden;
    margin: 0 auto;
}

.loading-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #6C5CE7, #00D9FF, #6C5CE7);
    background-size: 200% 100%;
    animation: progressMove 1.5s ease-in-out infinite;
    border-radius: 3px;
}

@keyframes progressMove {
    0% {
        width: 0%;
        background-position: 0% 50%;
    }
    50% {
        width: 70%;
        background-position: 100% 50%;
    }
    100% {
        width: 100%;
        background-position: 0% 50%;
    }
}

.loading-steps {
    margin-top: 24px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.loading-step {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 0.9rem;
    color: #6B7280;
    opacity: 0;
    animation: stepFadeIn 0.5s ease forwards;
}

.loading-step.active {
    color: #00D9FF;
}

.loading-step i {
    font-size: 0.8rem;
}

@keyframes stepFadeIn {
    to { opacity: 1; }
}

@media (max-width: 900px) {
    .results-grid {
        grid-template-columns: 1fr;
    }

    .premium-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 600px) {
    .test-hero h1 {
        font-size: 1.8rem;
    }

    .question-card {
        padding: 25px;
    }
}
</style>

<script>
const questions = [
    {
        q: "–ö–∞–∫ –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è?",
        options: ["–ß–∏—Ç–∞—Ç—å –∫–Ω–∏–≥–∏, –∏–∑—É—á–∞—Ç—å –Ω–æ–≤–æ–µ", "–û–±—â–∞—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏", "–ó–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–ø–æ—Ä—Ç–æ–º –∏–ª–∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ–º", "–ò–≥—Ä–∞—Ç—å –≤ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –∏–≥—Ä—ã –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å", "–ü–æ–º–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–º –ª—é–¥—è–º"]
    },
    {
        q: "–ö–∞–∫–æ–π —à–∫–æ–ª—å–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –≤–∞–º –Ω—Ä–∞–≤–∏–ª—Å—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
        options: ["–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∏ —Ñ–∏–∑–∏–∫–∞", "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞ –∏ —è–∑—ã–∫–∏", "–ë–∏–æ–ª–æ–≥–∏—è –∏ —Ö–∏–º–∏—è", "–ò—Å—Ç–æ—Ä–∏—è –∏ –æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ", "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"]
    },
    {
        q: "–ö–∞–∫ –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –≤–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è?",
        options: ["–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ñ–∞–∫—Ç—ã –∏ –¥–∞–Ω–Ω—ã–µ", "–ü—Ä–∏—Å–ª—É—à–∏–≤–∞—é—Å—å –∫ –∏–Ω—Ç—É–∏—Ü–∏–∏", "–°–æ–≤–µ—Ç—É—é—Å—å —Å –±–ª–∏–∑–∫–∏–º–∏", "–ò—â—É –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è", "–°–ª–µ–¥—É—é —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º"]
    },
    {
        q: "–í –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç–µ –≤—ã –æ–±—ã—á–Ω–æ...",
        options: ["–ë–µ—Ä—É –Ω–∞ —Å–µ–±—è –ª–∏–¥–µ—Ä—Å—Ç–≤–æ", "–ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–¥–µ–∏", "–í—ã–ø–æ–ª–Ω—è—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏", "–ü–æ–º–æ–≥–∞—é –Ω–∞–ª–∞–¥–∏—Ç—å –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é", "–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∏ –ø–ª–∞–Ω–∏—Ä—É—é"]
    },
    {
        q: "–ö–∞–∫–∞—è —Ä–∞–±–æ—á–∞—è —Å—Ä–µ–¥–∞ –≤–∞–º –±–ª–∏–∂–µ?",
        options: ["–¢–∏—Ö–∏–π –æ—Ñ–∏—Å —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º", "–ê–∫—Ç–∏–≤–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ —Å –ª—é–¥—å–º–∏", "–¢–≤–æ—Ä—á–µ—Å–∫–∞—è –º–∞—Å—Ç–µ—Ä—Å–∫–∞—è", "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –∏–ª–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä", "–†–∞–±–æ—Ç–∞ –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ"]
    },
    {
        q: "–ß—Ç–æ –¥–ª—è –≤–∞—Å –≤–∞–∂–Ω–µ–µ –≤ –±—É–¥—É—â–µ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏?",
        options: ["–í—ã—Å–æ–∫–∏–π –¥–æ—Ö–æ–¥", "–¢–≤–æ—Ä—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è", "–ü–æ–º–æ—â—å –ª—é–¥—è–º", "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", "–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ"]
    },
    {
        q: "–ö–∞–∫ –≤—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –ø—É–±–ª–∏—á–Ω—ã–º –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è–º?",
        options: ["–õ—é–±–ª—é –±—ã—Ç—å –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è", "–ù–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é—Å—å", "–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –∏–∑–±–µ–≥–∞—Ç—å", "–ú–æ–≥—É, –µ—Å–ª–∏ —Ç–µ–º–∞ –º–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞", "–õ—É—á—à–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞ –∫—É–ª–∏—Å–∞–º–∏"]
    },
    {
        q: "–ö–∞–∫–æ–π —Ç–∏–ø –∑–∞–¥–∞—á –≤–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ?",
        options: ["–†–µ—à–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏", "–°–æ–∑–¥–∞–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ", "–û—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å", "–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å", "–û–±—â–∞—Ç—å—Å—è –∏ —É–±–µ–∂–¥–∞—Ç—å"]
    },
    {
        q: "–ö–∞–∫ –≤—ã —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º?",
        options: ["–°–æ—Å—Ç–∞–≤–ª—è—é –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π", "–ó–∞–Ω–∏–º–∞—é—Å—å —Å–ø–æ—Ä—Ç–æ–º –∏–ª–∏ —Ö–æ–±–±–∏", "–û–±—â–∞—é—Å—å —Å –±–ª–∏–∑–∫–∏–º–∏", "–ò—â—É —Ç–≤–æ—Ä—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ", "–î–∞—é —Å–µ–±–µ –≤—Ä–µ–º—è —É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è"]
    },
    {
        q: "–ß—Ç–æ –≤–∞—Å –±–æ–ª—å—à–µ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç?",
        options: ["–ü—Ä–∏–∑–Ω–∞–Ω–∏–µ –∏ —É—Å–ø–µ—Ö", "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∑–∞–¥–∞—á–∏", "–î–µ–Ω–µ–∂–Ω–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ", "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–º–æ–≥–∞—Ç—å", "–°–≤–æ–±–æ–¥–∞ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å"]
    },
    {
        q: "–ö–∞–∫ –≤—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ —Ä–∞–±–æ—Ç–µ —Å —Ü–∏—Ñ—Ä–∞–º–∏ –∏ –¥–∞–Ω–Ω—ã–º–∏?",
        options: ["–≠—Ç–æ –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, —è –≤ —ç—Ç–æ–º —Å–∏–ª—ë–Ω", "–ù–æ—Ä–º–∞–ª—å–Ω–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ", "–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –∏–∑–±–µ–≥–∞—Ç—å", "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å —Å–º—ã—Å–ª", "–ú–Ω–µ –±–ª–∏–∂–µ —Ä–∞–±–æ—Ç–∞ —Å –ª—é–¥—å–º–∏"]
    },
    {
        q: "–ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –æ–±—É—á–µ–Ω–∏—è –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç?",
        options: ["–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ", "–õ–µ–∫—Ü–∏–∏ –∏ —Å–µ–º–∏–Ω–∞—Ä—ã", "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–Ω—è—Ç–∏—è", "–ì—Ä—É–ø–ø–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã", "–ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ –æ–¥–∏–Ω –Ω–∞ –æ–¥–∏–Ω"]
    },
    {
        q: "–ß—Ç–æ –±—ã –≤—ã –≤—ã–±—Ä–∞–ª–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ö–æ–±–±–∏?",
        options: ["–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞", "–†–∏—Å–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –º—É–∑—ã–∫–∞", "–í–æ–ª–æ–Ω—Ç—ë—Ä—Å—Ç–≤–æ", "–°–ø–æ—Ä—Ç –∏–ª–∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è", "–ß—Ç–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞—É—á–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è"]
    },
    {
        q: "–ö–∞–∫ –≤—ã –≤–∏–¥–∏—Ç–µ —Å–µ–±—è —á–µ—Ä–µ–∑ 10 –ª–µ—Ç?",
        options: ["–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º –∫–æ–º–ø–∞–Ω–∏–∏", "–ò–∑–≤–µ—Å—Ç–Ω—ã–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º –≤ —Å–≤–æ–µ–π –æ–±–ª–∞—Å—Ç–∏", "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–º", "–£—á—ë–Ω—ã–º –∏–ª–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–º", "–°—á–∞—Å—Ç–ª–∏–≤—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º —Å –±–∞–ª–∞–Ω—Å–æ–º —Ä–∞–±–æ—Ç—ã –∏ –∂–∏–∑–Ω–∏"]
    },
    {
        q: "–ö–∞–∫–∞—è –æ—Ç—Ä–∞—Å–ª—å –≤–∞—Å –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
        options: ["IT –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "–ú–µ–¥–∏—Ü–∏–Ω–∞ –∏ –∑–¥–æ—Ä–æ–≤—å–µ", "–ë–∏–∑–Ω–µ—Å –∏ —Ñ–∏–Ω–∞–Ω—Å—ã", "–ò—Å–∫—É—Å—Å—Ç–≤–æ –∏ –¥–∏–∑–∞–π–Ω", "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—É–∫–∞"]
    }
];

let currentQuestion = 0;
let answers = {};

document.addEventListener('DOMContentLoaded', () => {
    renderQuestions();
    showQuestion(0);
});

function renderQuestions() {
    const container = document.getElementById('testQuestions');

    questions.forEach((q, index) => {
        const card = document.createElement('div');
        card.className = 'question-card';
        card.id = `question-${index}`;

        card.innerHTML = `
            <h3><span class="q-number">${index + 1}</span>${q.q}</h3>
            <div class="answers-list">
                ${q.options.map((opt, optIndex) => `
                    <label class="answer-option" onclick="selectAnswer(${index}, '${opt.replace(/'/g, "\\'")}')">
                        <input type="radio" name="q${index}" value="${opt}">
                        <span class="radio-custom"></span>
                        <span>${opt}</span>
                    </label>
                `).join('')}
            </div>
            <div class="question-nav">
                ${index > 0 ? `<button class="btn btn-outline" onclick="prevQuestion()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>` : '<div></div>'}
                ${index < questions.length - 1
                    ? `<button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn-${index}" disabled><i class="fas fa-arrow-right"></i> –î–∞–ª–µ–µ</button>`
                    : `<button class="btn btn-primary" onclick="submitTest()" id="submitBtn" disabled><i class="fas fa-check"></i> –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>`
                }
            </div>
        `;

        container.appendChild(card);
    });
}

function showQuestion(index) {
    document.querySelectorAll('.question-card').forEach(card => card.classList.remove('active'));
    document.getElementById(`question-${index}`).classList.add('active');

    // Update progress
    const progress = ((index + 1) / questions.length) * 100;
    document.getElementById('progressFill').style.width = `${progress}%`;
    document.getElementById('progressText').textContent = `–í–æ–ø—Ä–æ—Å ${index + 1} –∏–∑ ${questions.length}`;

    currentQuestion = index;
}

function selectAnswer(questionIndex, answer) {
    answers[questions[questionIndex].q] = answer;

    // Mark selected
    document.querySelectorAll(`#question-${questionIndex} .answer-option`).forEach(opt => opt.classList.remove('selected'));
    event.currentTarget.classList.add('selected');

    // Enable next button
    const nextBtn = document.getElementById(`nextBtn-${questionIndex}`) || document.getElementById('submitBtn');
    if (nextBtn) nextBtn.disabled = false;
}

function nextQuestion() {
    if (currentQuestion < questions.length - 1) {
        showQuestion(currentQuestion + 1);
    }
}

function prevQuestion() {
    if (currentQuestion > 0) {
        showQuestion(currentQuestion - 1);
    }
}

async function submitTest() {
    // Create loading overlay with dark theme
    const loading = document.createElement('div');
    loading.className = 'loading-overlay';
    loading.id = 'loadingOverlay';
    loading.innerHTML = `
        <div class="loading-content">
            <div class="loading-icon">
                <div class="loading-spinner"></div>
                <i class="fas fa-brain loading-brain"></i>
            </div>
            <div class="loading-title">AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∞—à–∏ –æ—Ç–≤–µ—Ç—ã</div>
            <div class="loading-text">–ü–æ–¥–æ–∂–¥–∏—Ç–µ, —ç—Ç–æ –∑–∞–π–º—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
            <div class="loading-steps">
                <div class="loading-step active" style="animation-delay: 0s;"><i class="fas fa-check-circle"></i> –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤</div>
                <div class="loading-step" style="animation-delay: 0.8s;"><i class="fas fa-circle"></i> –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª—è</div>
                <div class="loading-step" style="animation-delay: 1.6s;"><i class="fas fa-circle"></i> –ü–æ–¥–±–æ—Ä —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π</div>
            </div>
        </div>
    `;
    document.body.appendChild(loading);

    // Animate steps
    const steps = loading.querySelectorAll('.loading-step');
    let stepIndex = 0;
    const stepInterval = setInterval(() => {
        if (stepIndex < steps.length) {
            steps.forEach((step, i) => {
                if (i <= stepIndex) {
                    step.classList.add('active');
                    step.querySelector('i').className = 'fas fa-check-circle';
                }
            });
            stepIndex++;
        }
    }, 800);

    try {
        const response = await fetch('/api/career-test/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ answers })
        });

        const data = await response.json();

        clearInterval(stepInterval);

        // Mark all steps as complete before hiding
        steps.forEach(step => {
            step.classList.add('active');
            step.querySelector('i').className = 'fas fa-check-circle';
        });

        // Small delay for visual feedback
        await new Promise(resolve => setTimeout(resolve, 300));

        const loadingEl = document.getElementById('loadingOverlay');
        if (loadingEl) loadingEl.remove();

        if (data.success) {
            showResults(data.result);
        } else {
            alert('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: ' + data.error);
        }
    } catch (error) {
        clearInterval(stepInterval);
        const loadingEl = document.getElementById('loadingOverlay');
        if (loadingEl) loadingEl.remove();
        alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
    }
}

function showResults(result) {
    document.getElementById('testQuestions').style.display = 'none';
    document.querySelector('.test-progress').style.display = 'none';

    const resultsDiv = document.getElementById('testResults');
    resultsDiv.style.display = 'block';

    resultsDiv.innerHTML = `
        <div class="results-header">
            <h2>üéâ –í–∞—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ—Ç–æ–≤—ã!</h2>
            <p>AI –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤–∞—à–∏ –æ—Ç–≤–µ—Ç—ã –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</p>
        </div>

        <div class="results-grid">
            <div class="result-card full-width">
                <h4><i class="fas fa-user"></i> –í–∞—à —Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏</h4>
                <div class="personality-badge">${result.personality_type}</div>
            </div>

            <div class="result-card">
                <h4><i class="fas fa-chart-bar"></i> –ü—Ä–æ—Ñ–∏–ª—å –Ω–∞–≤—ã–∫–æ–≤</h4>
                <div class="skills-chart">
                    ${Object.entries(result.skills_scores).map(([skill, value]) => `
                        <div class="skill-bar">
                            <span class="label">${skill}</span>
                            <div class="bar"><div class="fill" style="width: ${value}%"></div></div>
                            <span class="value">${value}%</span>
                        </div>
                    `).join('')}
                </div>
            </div>

            <div class="result-card">
                <h4><i class="fas fa-star"></i> –í–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</h4>
                <div class="tags-list">
                    ${result.strengths.map(s => `<span class="tag">${s}</span>`).join('')}
                </div>
            </div>

            <div class="result-card">
                <h4><i class="fas fa-graduation-cap"></i> –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h4>
                <div class="tags-list">
                    ${result.recommended_fields.map(f => `<span class="tag">${f}</span>`).join('')}
                </div>
            </div>

            <div class="result-card">
                <h4><i class="fas fa-briefcase"></i> –ü–æ–¥—Ö–æ–¥—è—â–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</h4>
                <div class="careers-list">
                    ${result.career_paths.map(c => `
                        <div class="career-item"><i class="fas fa-check-circle"></i> ${c}</div>
                    `).join('')}
                </div>
            </div>

            <div class="result-card full-width">
                <h4><i class="fas fa-lightbulb"></i> –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å–æ–≤–µ—Ç</h4>
                <p class="advice-text">${result.advice}</p>
            </div>
        </div>

        <div class="uni-recommendations">
            <h3><i class="fas fa-university"></i> –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –¥–ª—è –≤–∞—Å</h3>
            <div class="uni-rec-grid">
                ${result.recommended_universities.map(uni => `
                    <div class="uni-rec-card">
                        <h4>${uni.name_ru}</h4>
                        <div class="city"><i class="fas fa-map-marker-alt"></i> ${uni.city}</div>
                        <span class="focus-tag">${uni.focus}</span>
                        <a href="/university/${uni.id}" class="btn btn-outline btn-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                    </div>
                `).join('')}
            </div>
        </div>
    `;

    // Show premium tests
    document.getElementById('premiumTests').style.display = 'block';

    // Animate skill bars
    setTimeout(() => {
        document.querySelectorAll('.skill-bar .fill').forEach(fill => {
            fill.style.width = fill.style.width;
        });
    }, 100);
}

function showPaymentModal(testType) {
    document.getElementById('paymentModal').classList.add('active');
}

function closePaymentModal() {
    document.getElementById('paymentModal').classList.remove('active');
}
</script>
{% endblock %}

